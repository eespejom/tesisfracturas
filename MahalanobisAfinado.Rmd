---
title: "Mahalobis"
author: "Edgar Espejo"
date: '2022-12-13'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Comparación de fotos de los tipos de fracturas

```{r}
# libreria de lectura de bitmaps para bmp, jpeg, png y tiff
library(readbitmap)
library(fda)
library(ggplot2)
library(dplyr)
library(caret)
library(fda.usc)
library(gmfd)

```


# 1. Cargar imagenes dúctiles

Total de imagenes 10. Por cada foto 400 datos funcionales (lineas de pixeles en X y líneas de pixeles en y), para un total de 4000 datos.

```{r}
imagenductilent1 <- read.bitmap("DuctilEnt1.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilent1 <- imagenductilent1 [,,1] # Deja un solo canal
imagenductilent1t <- t(imagenductilent1) 
imagenductilent1xey <- rbind(imagenductilent1,imagenductilent1t)
imagenductilent1xey <- t(imagenductilent1xey)
dim(imagenductilent1xey)

imagenductilent2 <- read.bitmap("DuctilEnt2.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilent2 <- imagenductilent2 [,,1] # Deja un solo canal
imagenductilent2t <- t(imagenductilent2) 
imagenductilent2xey <- rbind(imagenductilent2,imagenductilent2t)
imagenductilent2xey <- t(imagenductilent2xey)
dim(imagenductilent2xey)

imagenductilent3 <- read.bitmap("DuctilEnt3.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilent3 <- imagenductilent3 [,,1] # Deja un solo canal
imagenductilent3t <- t(imagenductilent3) 
imagenductilent3xey <- rbind(imagenductilent3,imagenductilent3t)
imagenductilent3xey <- t(imagenductilent3xey)
dim(imagenductilent3xey)

imagenductilent4 <- read.bitmap("DuctilEnt4.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilent4 <- imagenductilent4 [,,1] # Deja un solo canal
imagenductilent4t <- t(imagenductilent4) 
imagenductilent4xey <- rbind(imagenductilent4,imagenductilent4t)
imagenductilent4xey <- t(imagenductilent4xey)
dim(imagenductilent4xey)

imagenductilent5 <- read.bitmap("DuctilEnt5.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilent5 <- imagenductilent5 [,,1] # Deja un solo canal
imagenductilent5t <- t(imagenductilent5) 
imagenductilent5xey <- rbind(imagenductilent5,imagenductilent5t)
imagenductilent5xey <- t(imagenductilent5xey)
dim(imagenductilent5xey)

imagenductilent6 <- read.bitmap("DuctilEnt6.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilent6 <- imagenductilent6 [,,1] # Deja un solo canal
imagenductilent6t <- t(imagenductilent6) 
imagenductilent6xey <- rbind(imagenductilent6,imagenductilent6t)
imagenductilent6xey <- t(imagenductilent6xey)
dim(imagenductilent6xey)

imagenductilent7 <- read.bitmap("DuctilEnt7.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilent7 <- imagenductilent7 [,,1] # Deja un solo canal
imagenductilent7t <- t(imagenductilent7) 
imagenductilent7xey <- rbind(imagenductilent7,imagenductilent7t)
imagenductilent7xey <- t(imagenductilent7xey)
dim(imagenductilent7xey)

imagenductilens1 <- read.bitmap("DuctilEns1.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilens1 <- imagenductilens1 [,,1] # Deja un solo canal
imagenductilens1t <- t(imagenductilens1) 
imagenductilens1xey <- rbind(imagenductilens1,imagenductilens1t)
imagenductilens1xey <- t(imagenductilens1xey)
dim(imagenductilens1xey)

imagenductilens2 <- read.bitmap("DuctilEns2.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilens2 <- imagenductilens2 [,,1] # Deja un solo canal
imagenductilens2t <- t(imagenductilens2) 
imagenductilens2xey <- rbind(imagenductilens2,imagenductilens2t)
imagenductilens2xey <- t(imagenductilens2xey)
dim(imagenductilens2xey)

imagenductilens3 <- read.bitmap("DuctilEns3.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenductilens3 <- imagenductilens3 [,,1] # Deja un solo canal
imagenductilens3t <- t(imagenductilens3) 
imagenductilens3xey <- rbind(imagenductilens3,imagenductilens3t)
imagenductilens3xey <- t(imagenductilens3xey)
dim(imagenductilens3xey)

imagenductilxey <- cbind(imagenductilent1xey,imagenductilent2xey,imagenductilent3xey,imagenductilent4xey,imagenductilent5xey,imagenductilent6xey,imagenductilent7xey,imagenductilens1xey,imagenductilens2xey,imagenductilens3xey)

dim(imagenductilxey)

# Convertir en Data Frame Ductil
imagenductilxeydf <- as.data.frame (imagenductilxey)
attributes(imagenductilxeydf)
# las filas son el número de puntos de evaluación de la función y las columnas el número de curvas
# Suavizamiento spline
# Creación de la base de funciones
npuntos <- nrow(imagenductilxeydf)
base_bspline <- create.bspline.basis(c(1, npuntos), 150)
plot(base_bspline)
summary(base_bspline)

# Selección de lambda
gcv <- NULL
lambda_list <- seq(-2, 4, length.out = 30)
# estos son las potencias de 10 de variación del lambda
# inicia con valores muy cercanos a cero 10^-2 hasta 10^4
matrix_data <- as.matrix(imagenductilxeydf)
for (lambda in lambda_list) {
  lambda <- 10**lambda
  param_lambda <- fdPar(base_bspline,
                        2,
                        lambda)
  fd_smoothductil <- smooth.basis(argvals = seq(1,
                                          nrow(matrix_data)),
                            y = matrix_data,
                            fdParobj = param_lambda)
  gcv <- c(gcv, sum(fd_smoothductil$gcv))
}
# Se esta tomando como criterio total la suma de las VC de todas las curvas
plotgcv <-
  data.frame(log_lambda = lambda_list,
             gcv = gcv) %>% ggplot(aes(x = log_lambda, y = gcv)) +
  geom_line(color = "purple", linetype = "dashed") +
  theme_light() +
  scale_x_continuous(limits = c(0, 4))
plotly::ggplotly(plotgcv)
selected_lamdba <- 10**lambda_list[which.min(gcv)]
print(selected_lamdba)
print(log(selected_lamdba, 10))
# entrega el valor de lambda donde se minimiza la suma de VC y log de lambda

# Suavizamiento con el lambda elegido
param_lambda <- fdPar(base_bspline,
                      2,
                      lambda = selected_lamdba)

fd_smoothductil <- smooth.basis(argvals = seq(1,
                                        nrow(matrix_data)),
                          y = matrix_data,
                          fdParobj = param_lambda)
plot(fd_smoothductil, xlab= "Pixel", ylab = "Intensidad Totas Las Imagenes")


# una curva por cada foto

# Comparación de curvas originales y suavizadas
fd_fittedductil <- fitted(fd_smoothductil)
plot(imagenductilxey[,1],type = "o",xlab="Pixel",ylab="Intensidad Ent1")
lines(fd_fittedductil[,1],col="2")
plot(imagenductilxey[,401],type = "o",xlab="Pixel",ylab="Intensidad Ent2")
lines(fd_fittedductil[,401],col="2")
plot(imagenductilxey[,801],type = "o",xlab="Pixel",ylab="Intensidad Ent3")
lines(fd_fittedductil[,801],col="2")
plot(imagenductilxey[,1201],type = "o",xlab="Pixel",ylab="Intensidad Ent4")
lines(fd_fittedductil[,1201],col="2")
plot(imagenductilxey[,1601],type = "o",xlab="Pixel",ylab="Intensidad Ent5")
lines(fd_fittedductil[,1601],col="2")
plot(imagenductilxey[,2001],type = "o",xlab="Pixel",ylab="Intensidad Ent6")
lines(fd_fittedductil[,2001],col="2")
plot(imagenductilxey[,2401],type = "o",xlab="Pixel",ylab="Intensidad Ent7")
lines(fd_fittedductil[,2401],col="2")
plot(imagenductilxey[,2801],type = "o",xlab="Pixel",ylab="Intensidad Ens1")
lines(fd_fittedductil[,2801],col="2")
plot(imagenductilxey[,3201],type = "o",xlab="Pixel",ylab="Intensidad Ens2")
lines(fd_fittedductil[,3201],col="2")
plot(imagenductilxey[,3601],type = "o",xlab="Pixel",ylab="Intensidad Ens3")
lines(fd_fittedductil[,3601],col="2")
```


# 2. Cargar imagenes frágiles

Total de imagenes 10. Por cada foto 400 datos funcionales (lineas de pixeles en X y líneas de pixeles en y), para un total de 4000 datos.

```{r}
imagenfragilent1 <- read.bitmap("FragilEnt1.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilent1 <- imagenfragilent1 [,,1] # Deja un solo canal
imagenfragilent1t <- t(imagenfragilent1) 
imagenfragilent1xey <- rbind(imagenfragilent1,imagenfragilent1t)
imagenfragilent1xey <- t(imagenfragilent1xey)
dim(imagenfragilent1xey)

imagenfragilent2 <- read.bitmap("FragilEnt2.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilent2 <- imagenfragilent2 [,,1] # Deja un solo canal
imagenfragilent2t <- t(imagenfragilent2) 
imagenfragilent2xey <- rbind(imagenfragilent2,imagenfragilent2t)
imagenfragilent2xey <- t(imagenfragilent2xey)
dim(imagenfragilent2xey)

imagenfragilent3 <- read.bitmap("FragilEnt3.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilent3 <- imagenfragilent3 [,,1] # Deja un solo canal
imagenfragilent3t <- t(imagenfragilent3) 
imagenfragilent3xey <- rbind(imagenfragilent3,imagenfragilent3t)
imagenfragilent3xey <- t(imagenfragilent3xey)
dim(imagenfragilent3xey)

imagenfragilent4 <- read.bitmap("FragilEnt4.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilent4 <- imagenfragilent4 [,,1] # Deja un solo canal
imagenfragilent4t <- t(imagenfragilent4) 
imagenfragilent4xey <- rbind(imagenfragilent4,imagenfragilent4t)
imagenfragilent4xey <- t(imagenfragilent4xey)
dim(imagenfragilent4xey)

imagenfragilent5 <- read.bitmap("FragilEnt5.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilent5 <- imagenfragilent5 [,,1] # Deja un solo canal
imagenfragilent5t <- t(imagenfragilent5) 
imagenfragilent5xey <- rbind(imagenfragilent5,imagenfragilent5t)
imagenfragilent5xey <- t(imagenfragilent5xey)
dim(imagenfragilent5xey)

imagenfragilent6 <- read.bitmap("FragilEnt6.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilent6 <- imagenfragilent6 [,,1] # Deja un solo canal
imagenfragilent6t <- t(imagenfragilent6) 
imagenfragilent6xey <- rbind(imagenfragilent6,imagenfragilent6t)
imagenfragilent6xey <- t(imagenfragilent6xey)
dim(imagenfragilent6xey)

imagenfragilent7 <- read.bitmap("FragilEnt7.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilent7 <- imagenfragilent7 [,,1] # Deja un solo canal
imagenfragilent7t <- t(imagenfragilent7) 
imagenfragilent7xey <- rbind(imagenfragilent7,imagenfragilent7t)
imagenfragilent7xey <- t(imagenfragilent7xey)
dim(imagenfragilent7xey)

imagenfragilens1 <- read.bitmap("FragilEns1.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilens1 <- imagenfragilens1 [,,1] # Deja un solo canal
imagenfragilens1t <- t(imagenfragilens1) 
imagenfragilens1xey <- rbind(imagenfragilens1,imagenfragilens1t)
imagenfragilens1xey <- t(imagenfragilens1xey)
dim(imagenfragilens1xey)

imagenfragilens2 <- read.bitmap("FragilEns2.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilens2 <- imagenfragilens2 [,,1] # Deja un solo canal
imagenfragilens2t <- t(imagenfragilens2) 
imagenfragilens2xey <- rbind(imagenfragilens2,imagenfragilens2t)
imagenfragilens2xey <- t(imagenfragilens2xey)
dim(imagenfragilens2xey)

imagenfragilens3 <- read.bitmap("fragilEns3.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfragilens3 <- imagenfragilens3 [,,1] # Deja un solo canal
imagenfragilens3t <- t(imagenfragilens3) 
imagenfragilens3xey <- rbind(imagenfragilens3,imagenfragilens3t)
imagenfragilens3xey <- t(imagenfragilens3xey)
dim(imagenfragilens3xey)

imagenfragilxey <- cbind(imagenfragilent1xey,imagenfragilent2xey,imagenfragilent3xey,imagenfragilent4xey,imagenfragilent5xey,imagenfragilent6xey,imagenfragilent7xey,imagenfragilens1xey,imagenfragilens2xey,imagenfragilens3xey)

dim(imagenfragilxey)

# Convertir en Data Frame fragil
imagenfragilxeydf <- as.data.frame (imagenfragilxey)
attributes(imagenfragilxeydf)
# las filas son el número de puntos de evaluación de la función y las columnas el número de curvas
# Suavizamiento spline
# Creación de la base de funciones
npuntos <- nrow(imagenfragilxeydf)
base_bspline <- create.bspline.basis(c(1, npuntos), 150)
plot(base_bspline)
summary(base_bspline)

# Selección de lambda
gcv <- NULL
lambda_list <- seq(-2, 4, length.out = 30)
# estos son las potencias de 10 de variación del lambda
# inicia con valores muy cercanos a cero 10^-2 hasta 10^4
matrix_data <- as.matrix(imagenfragilxeydf)
for (lambda in lambda_list) {
  lambda <- 10**lambda
  param_lambda <- fdPar(base_bspline,
                        2,
                        lambda)
  fd_smoothfragil <- smooth.basis(argvals = seq(1,
                                          nrow(matrix_data)),
                            y = matrix_data,
                            fdParobj = param_lambda)
  gcv <- c(gcv, sum(fd_smoothfragil$gcv))
}
# Se esta tomando como criterio total la suma de las VC de todas las curvas
plotgcv <-
  data.frame(log_lambda = lambda_list,
             gcv = gcv) %>% ggplot(aes(x = log_lambda, y = gcv)) +
  geom_line(color = "purple", linetype = "dashed") +
  theme_light() +
  scale_x_continuous(limits = c(0, 4))
plotly::ggplotly(plotgcv)
selected_lamdba <- 10**lambda_list[which.min(gcv)]
print(selected_lamdba)
print(log(selected_lamdba, 10))
# entrega el valor de lambda donde se minimiza la suma de VC y log de lambda

# Suavizamiento con el lambda elegido
param_lambda <- fdPar(base_bspline,
                      2,
                      lambda = selected_lamdba)

fd_smoothfragil <- smooth.basis(argvals = seq(1,
                                        nrow(matrix_data)),
                          y = matrix_data,
                          fdParobj = param_lambda)
plot(fd_smoothfragil, xlab= "Pixel", ylab = "Intensidad Totas Las Imagenes")


# una curva por cada foto

# Comparación de curvas originales y suavizadas
fd_fittedfragil <- fitted(fd_smoothfragil)
plot(imagenfragilxey[,1],type = "o",xlab="Pixel",ylab="Intensidad Ent1")
lines(fd_fittedfragil[,1],col="2")
plot(imagenfragilxey[,401],type = "o",xlab="Pixel",ylab="Intensidad Ent2")
lines(fd_fittedfragil[,401],col="2")
plot(imagenfragilxey[,801],type = "o",xlab="Pixel",ylab="Intensidad Ent3")
lines(fd_fittedfragil[,801],col="2")
plot(imagenfragilxey[,1201],type = "o",xlab="Pixel",ylab="Intensidad Ent4")
lines(fd_fittedfragil[,1201],col="2")
plot(imagenfragilxey[,1601],type = "o",xlab="Pixel",ylab="Intensidad Ent5")
lines(fd_fittedfragil[,1601],col="2")
plot(imagenfragilxey[,2001],type = "o",xlab="Pixel",ylab="Intensidad Ent6")
lines(fd_fittedfragil[,2001],col="2")
plot(imagenfragilxey[,2401],type = "o",xlab="Pixel",ylab="Intensidad Ent7")
lines(fd_fittedfragil[,2401],col="2")
plot(imagenfragilxey[,2801],type = "o",xlab="Pixel",ylab="Intensidad Ens1")
lines(fd_fittedfragil[,2801],col="2")
plot(imagenfragilxey[,3201],type = "o",xlab="Pixel",ylab="Intensidad Ens2")
lines(fd_fittedfragil[,3201],col="2")
plot(imagenfragilxey[,3601],type = "o",xlab="Pixel",ylab="Intensidad Ens3")
lines(fd_fittedfragil[,3601],col="2")
```


# 3. Cargar imagenes fatiga

Total de imagenes 10. Por cada foto 400 datos funcionales (lineas de pixeles en X y líneas de pixeles en y), para un total de 4000 datos.

```{r}
imagenfatigaent1 <- read.bitmap("FatigaEnt1.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaent1 <- imagenfatigaent1 [,,1] # Deja un solo canal
imagenfatigaent1t <- t(imagenfatigaent1) 
imagenfatigaent1xey <- rbind(imagenfatigaent1,imagenfatigaent1t)
imagenfatigaent1xey <- t(imagenfatigaent1xey)
dim(imagenfatigaent1xey)

imagenfatigaent2 <- read.bitmap("FatigaEnt2.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaent2 <- imagenfatigaent2 [,,1] # Deja un solo canal
imagenfatigaent2t <- t(imagenfatigaent2) 
imagenfatigaent2xey <- rbind(imagenfatigaent2,imagenfatigaent2t)
imagenfatigaent2xey <- t(imagenfatigaent2xey)
dim(imagenfatigaent2xey)

imagenfatigaent3 <- read.bitmap("FatigaEnt3.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaent3 <- imagenfatigaent3 [,,1] # Deja un solo canal
imagenfatigaent3t <- t(imagenfatigaent3) 
imagenfatigaent3xey <- rbind(imagenfatigaent3,imagenfatigaent3t)
imagenfatigaent3xey <- t(imagenfatigaent3xey)
dim(imagenfatigaent3xey)

imagenfatigaent4 <- read.bitmap("FatigaEnt4.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaent4 <- imagenfatigaent4 [,,1] # Deja un solo canal
imagenfatigaent4t <- t(imagenfatigaent4) 
imagenfatigaent4xey <- rbind(imagenfatigaent4,imagenfatigaent4t)
imagenfatigaent4xey <- t(imagenfatigaent4xey)
dim(imagenfatigaent4xey)

imagenfatigaent5 <- read.bitmap("FatigaEnt5.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaent5 <- imagenfatigaent5 [,,1] # Deja un solo canal
imagenfatigaent5t <- t(imagenfatigaent5) 
imagenfatigaent5xey <- rbind(imagenfatigaent5,imagenfatigaent5t)
imagenfatigaent5xey <- t(imagenfatigaent5xey)
dim(imagenfatigaent5xey)

imagenfatigaent6 <- read.bitmap("FatigaEnt6.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaent6 <- imagenfatigaent6 [,,1] # Deja un solo canal
imagenfatigaent6t <- t(imagenfatigaent6) 
imagenfatigaent6xey <- rbind(imagenfatigaent6,imagenfatigaent6t)
imagenfatigaent6xey <- t(imagenfatigaent6xey)
dim(imagenfatigaent6xey)

imagenfatigaent7 <- read.bitmap("FatigaEnt7.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaent7 <- imagenfatigaent7 [,,1] # Deja un solo canal
imagenfatigaent7t <- t(imagenfatigaent7) 
imagenfatigaent7xey <- rbind(imagenfatigaent7,imagenfatigaent7t)
imagenfatigaent7xey <- t(imagenfatigaent7xey)
dim(imagenfatigaent7xey)

imagenfatigaens1 <- read.bitmap("FatigaEns1.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaens1 <- imagenfatigaens1 [,,1] # Deja un solo canal
imagenfatigaens1t <- t(imagenfatigaens1) 
imagenfatigaens1xey <- rbind(imagenfatigaens1,imagenfatigaens1t)
imagenfatigaens1xey <- t(imagenfatigaens1xey)
dim(imagenfatigaens1xey)

imagenfatigaens2 <- read.bitmap("FatigaEns2.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaens2 <- imagenfatigaens2 [,,1] # Deja un solo canal
imagenfatigaens2t <- t(imagenfatigaens2) 
imagenfatigaens2xey <- rbind(imagenfatigaens2,imagenfatigaens2t)
imagenfatigaens2xey <- t(imagenfatigaens2xey)
dim(imagenfatigaens2xey)

imagenfatigaens3 <- read.bitmap("FatigaEns3.jpg") # crea una matriz de x filas y columanas y z=3 canales
imagenfatigaens3 <- imagenfatigaens3 [,,1] # Deja un solo canal
imagenfatigaens3t <- t(imagenfatigaens3) 
imagenfatigaens3xey <- rbind(imagenfatigaens3,imagenfatigaens3t)
imagenfatigaens3xey <- t(imagenfatigaens3xey)
dim(imagenfatigaens3xey)

imagenfatigaxey <- cbind(imagenfatigaent1xey,imagenfatigaent2xey,imagenfatigaent3xey,imagenfatigaent4xey,imagenfatigaent5xey,imagenfatigaent6xey,imagenfatigaent7xey,imagenfatigaens1xey,imagenfatigaens2xey,imagenfatigaens3xey)

dim(imagenfatigaxey)

# Convertir en Data Frame fatiga
imagenfatigaxeydf <- as.data.frame (imagenfatigaxey)
attributes(imagenfatigaxeydf)
# las filas son el número de puntos de evaluación de la función y las columnas el número de curvas
# Suavizamiento spline
# Creación de la base de funciones
npuntos <- nrow(imagenfatigaxeydf)
base_bspline <- create.bspline.basis(c(1, npuntos), 150)
plot(base_bspline)
summary(base_bspline)

# Selección de lambda
gcv <- NULL
lambda_list <- seq(-2, 4, length.out = 30)
# estos son las potencias de 10 de variación del lambda
# inicia con valores muy cercanos a cero 10^-2 hasta 10^4
matrix_data <- as.matrix(imagenfatigaxeydf)
for (lambda in lambda_list) {
  lambda <- 10**lambda
  param_lambda <- fdPar(base_bspline,
                        2,
                        lambda)
  fd_smoothfatiga <- smooth.basis(argvals = seq(1,
                                          nrow(matrix_data)),
                            y = matrix_data,
                            fdParobj = param_lambda)
  gcv <- c(gcv, sum(fd_smoothfatiga$gcv))
}
# Se esta tomando como criterio total la suma de las VC de todas las curvas
plotgcv <-
  data.frame(log_lambda = lambda_list,
             gcv = gcv) %>% ggplot(aes(x = log_lambda, y = gcv)) +
  geom_line(color = "purple", linetype = "dashed") +
  theme_light() +
  scale_x_continuous(limits = c(0, 4))
plotly::ggplotly(plotgcv)
selected_lamdba <- 10**lambda_list[which.min(gcv)]
print(selected_lamdba)
print(log(selected_lamdba, 10))
# entrega el valor de lambda donde se minimiza la suma de VC y log de lambda

# Suavizamiento con el lambda elegido
param_lambda <- fdPar(base_bspline,
                      2,
                      lambda = selected_lamdba)

fd_smoothfatiga <- smooth.basis(argvals = seq(1,
                                        nrow(matrix_data)),
                          y = matrix_data,
                          fdParobj = param_lambda)
plot(fd_smoothfatiga, xlab= "Pixel", ylab = "Intensidad Totas Las Imagenes")


# una curva por cada foto

# Comparación de curvas originales y suavizadas
fd_fittedfatiga <- fitted(fd_smoothfatiga)
plot(imagenfatigaxey[,1],type = "o",xlab="Pixel",ylab="Intensidad Ent1")
lines(fd_fittedfatiga[,1],col="2")
plot(imagenfatigaxey[,401],type = "o",xlab="Pixel",ylab="Intensidad Ent2")
lines(fd_fittedfatiga[,401],col="2")
plot(imagenfatigaxey[,801],type = "o",xlab="Pixel",ylab="Intensidad Ent3")
lines(fd_fittedfatiga[,801],col="2")
plot(imagenfatigaxey[,1201],type = "o",xlab="Pixel",ylab="Intensidad Ent4")
lines(fd_fittedfatiga[,1201],col="2")
plot(imagenfatigaxey[,1601],type = "o",xlab="Pixel",ylab="Intensidad Ent5")
lines(fd_fittedfatiga[,1601],col="2")
plot(imagenfatigaxey[,2001],type = "o",xlab="Pixel",ylab="Intensidad Ent6")
lines(fd_fittedfatiga[,2001],col="2")
plot(imagenfatigaxey[,2401],type = "o",xlab="Pixel",ylab="Intensidad Ent7")
lines(fd_fittedfatiga[,2401],col="2")
plot(imagenfatigaxey[,2801],type = "o",xlab="Pixel",ylab="Intensidad Ens1")
lines(fd_fittedfatiga[,2801],col="2")
plot(imagenfatigaxey[,3201],type = "o",xlab="Pixel",ylab="Intensidad Ens2")
lines(fd_fittedfatiga[,3201],col="2")
plot(imagenfatigaxey[,3601],type = "o",xlab="Pixel",ylab="Intensidad Ens3")
lines(fd_fittedfatiga[,3601],col="2")
```


# 4 Análisis de Componentes Principales de cada grupo de curvas de entrenamiento

El objetivo es encontrar los valores y funciones propias para cada grupo.


# 4.1 Estimación de PCA grupo de entrenamiento ductil

Los porcentajes de varianza que recogen las cinco primeras funciones principales son: 12.969659  4.519105  3.530871  3.285440  3.024437.  

```{r}

# Estimación de valores propios, scores y funciones propias para las curvas combinadas de dúctil, frágil y fatiga
Curvas_Ductil.pca<-pca.fd(fd_smoothductil$fd[1:2800],nharm=150,harmfdPar = fdPar(fd_smoothductil$fd[1:2800]))

lambda_ductil<-Curvas_Ductil.pca$values
# Valores propios

v_ductil<-Curvas_Ductil.pca$harmonics
# funciones propias

sum_val_prop_ductil <- sum(Curvas_Ductil.pca$values)
# suma de valores propios

Val_prop_percent_ductil <- (Curvas_Ductil.pca$values/sum_val_prop_ductil)*100;Val_prop_percent_ductil
# Porcentaje de la varianza de valores propios

Val_prop_percent_ductil[1:5]

```

# 4.2 Estimación de PCA grupo de entrenamiento fragil

Los porcentajes de varianza que recogen las cinco primeras funciones principales son: 6.975348 2.676822 2.159655 2.018449 1.899010.  

```{r}

# Estimación de valores propios, scores y funciones propias para las curvas combinadas de dúctil, frágil y fatiga
Curvas_Fragil.pca<-pca.fd(fd_smoothfragil$fd[1:2800],nharm=150,harmfdPar = fdPar(fd_smoothfragil$fd[1:2800]))

lambda_fragil<-Curvas_Fragil.pca$values
# Valores propios

v_fragil<-Curvas_Fragil.pca$harmonics
# funciones propias

sum_val_prop_fragil <- sum(Curvas_Fragil.pca$values)
# suma de valores propios

Val_prop_percent_fragil <- (Curvas_Fragil.pca$values/sum_val_prop_fragil)*100;Val_prop_percent_fragil
# Porcentaje de la varianza de valores propios

Val_prop_percent_fragil[1:5]

```

# 4.3 Estimación de PCA grupo de entrenamiento fatiga

Los porcentajes de varianza que recogen las cinco primeras funciones principales son:  18.480613  2.771575  1.918383  1.594192  1.550577.  

```{r}

# Estimación de valores propios, scores y funciones propias para las curvas combinadas de dúctil, frágil y fatiga
Curvas_Fatiga.pca<-pca.fd(fd_smoothfatiga$fd[1:2800],nharm=150,harmfdPar = fdPar(fd_smoothfatiga$fd[1:2800]))

lambda_fatiga<-Curvas_Fatiga.pca$values
# Valores propios

v_fatiga<-Curvas_Fatiga.pca$harmonics
# funciones propias

sum_val_prop_fatiga <- sum(Curvas_Fatiga.pca$values)
# suma de valores propios

Val_prop_percent_fatiga <- (Curvas_Fatiga.pca$values/sum_val_prop_fatiga)*100;Val_prop_percent_fatiga
# Porcentaje de la varianza de valores propios

Val_prop_percent_fatiga[1:5]

```

# 5 Funciones media de las imagenes de entrenamiento

Se calculan para cada grupo de entrenamiento.  

```{r}
mean_functionductil <- mean.fd(fd_smoothductil$fd[1:2800])
mean_functionductil <- fdata(mean_functionductil,1:200) 
# Se pasa a objeto fdata para extraer la matriz de valores
mean_functionfragil <- mean.fd(fd_smoothfragil$fd[1:2800])
mean_functionfragil <- fdata(mean_functionfragil,1:200)
# Se pasa a objeto fdata para extraer la matriz de valores
mean_functionfatiga <- mean.fd(fd_smoothfatiga$fd[1:2800])
mean_functionfatiga <- fdata(mean_functionfatiga,1:200)
# Se pasa a objeto fdata para extraer la matriz de valores
```

# 6 Cálculo de las distancias de Mahalanobis de las curvas de ensayo a cada media (Usando 150 harmonicos de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 150)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 150)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 150)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 150)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 150)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 150)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 150)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 150)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 150)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 7 Generación tablas de contingencia por curva

La fracción de acierto global es de 0.3597222, para imágenes dúctiles es de 0.0875, para imágenes frágiles de 0.9916667 y para imágenes de fatiga 0.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```


# 7.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.33333333,

Las tres dúctiles se adjudican a frágil. Acierto 0%.
Las tres frágiles se adjudican correctamente. Acierto 100%.
Las tres de fatiga adjudicaron a Frágil. Acierto 0%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```

# 8 Cálculo de las distancias de Mahalanobis de las curvas de ensayo a cada media (Usando 1 harmonico de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 1)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 1)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 1)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 1)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 1)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 1)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 1)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 1)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 1)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 9 Generación tablas de contingencia

La fracción de acierto global es de 0.5975, para imágenes dúctiles es de 0.7716667, para imágenes frágiles de 0.655 y para imágenes de fatiga 0.3658333.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```

# 9.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.7777778,

Las tres dúctiles se adjudican a dúctil. Acierto 100%.
Las tres frágiles se adjudican correctamente. Acierto 100%.
Una de fatiga se adjudicó correcta. Acierto 33%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```

# 10 Cálculo de las distancias de Mahalanobis de las curvas de ensayo a cada media (Usando 2 harmonico de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 2)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 2)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 2)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 2)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 2)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 2)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 2)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 2)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 2)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 11 Generación tablas de contingencia

La fracción de acierto global es de 0.5791667, para imágenes dúctiles es de 0.82, para imágenes frágiles de 0.7183333 y para imágenes de fatiga 0.1991667.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```

# 11.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.7777778,

Las tres dúctiles se adjudican a dúctil. Acierto 100%.
Las tres frágiles se adjudican correctamente. Acierto 100%.
Una de fatiga se adjudicó correcta. Acierto 33%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```

# 12 Cálculo de las distancias de Mahalanobis de las curvas de ensayo a cada media (Usando 3 harmonico de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 3)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 3)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 3)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 3)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 3)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 3)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 3)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 3)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "trunc", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 3)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 13 Generación tablas de contingencia

La fracción de acierto global es de 0.5519444, para imágenes dúctiles es de 0.7858333, para imágenes frágiles de 0.732 y para imágenes de fatiga 0.1375.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```


# 13.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.6666667,

Las tres dúctiles se adjudican a dúctil. Acierto 100%.
Las tres frágiles se adjudican correctamente. Acierto 100%.
Ninguna de fatiga se adjudicó correcta. Acierto 0%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```
# 14 Cálculo de las distancias de L2 de las curvas de ensayo a cada media (Usando 150 harmonicos de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 150)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 150)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 150)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 150)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 150)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 150)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 150)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 150)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 150)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 15 Generación tablas de contingencia por curva

La fracción de acierto global es de 0.5947222, para imágenes dúctiles es de 0.7608333, para imágenes frágiles de 0.6541667 y para imágenes de fatiga 0.3691667.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```


# 15.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.6666667,

Las tres dúctiles se adjudican bien. Acierto 100%.
Dos frágiles se adjudican correctamente. Acierto 66.6%.
Una de fatiga se adjudicó correctamente. Acierto 33.3%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```

# 16 Cálculo de las distancias de L2 de las curvas de ensayo a cada media (Usando 1 harmonico de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 1)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 1)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 1)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 1)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 1)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 1)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 1)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 1)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 1)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 17 Generación tablas de contingencia

La fracción de acierto global es de 0.5947222, para imágenes dúctiles es de 0.7608333, para imágenes frágiles de 0.6541667 y para imágenes de fatiga 0.3691667.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```

# 17.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.6666667,

Las tres dúctiles se adjudican a dúctil. Acierto 100%.
Dos de tres frágiles se adjudican correctamente. Acierto 66.6%.
Una de fatiga se adjudicó correcta. Acierto 33.3%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```

# 18 Cálculo de las distancias de L2 de las curvas de ensayo a cada media (Usando 2 harmonico de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 2)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 2)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 2)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 2)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 2)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 2)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 2)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 2)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 2)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 19 Generación tablas de contingencia

La fracción de acierto global es de 0.5947222, para imágenes dúctiles es de 0.7608333, para imágenes frágiles de 0.6541667 y para imágenes de fatiga 0.3691667.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```

# 19.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.6666667,

Las tres dúctiles se adjudican a dúctil. Acierto 100%.
Dos de tres frágiles se adjudican correctamente. Acierto 66.6%.
Una de fatiga se adjudicó correcta. Acierto 33.3%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```

# 20 Cálculo de las distancias de L2 de las curvas de ensayo a cada media (Usando 3 harmonico de los PCA)

```{r}
grilla <- seq( 1, 200, length.out = 200 )
fd_fittedductil <- fitted(fd_smoothductil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfragil <- fitted(fd_smoothfragil)
# Se obtienen las funciones de entrenamiento y ensayo como matriz
fd_fittedfatiga <- fitted(fd_smoothfatiga)
# Se obtienen las funciones de entrenamiento y ensayo como matriz

mean_functionductil_fundata <- funData(grilla,mean_functionductil$data)
# Se pasa la media a un objeto fundata
mean_functionfragil_fundata <- funData(grilla,mean_functionfragil$data)
# Se pasa la media a un objeto fundata
mean_functionfatiga_fundata <- funData(grilla,mean_functionfatiga$data)
# Se pasa la media a un objeto fundata

v_ductilfitted <- fdata(v_ductil,1:200)
# Se pasan las funciones propias a objeto fdata
v_ductilfittedmatrix <- t(v_ductilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fragilfitted <- fdata(v_fragil,1:200)
# Se pasan las funciones propias a objeto fdata
v_fragilfittedmatrix <- t(v_fragilfitted$data)
# Se extrae la matriz de datos de las funciones propias
v_fatigafitted <- fdata(v_fatiga,1:200)
# Se pasan las funciones propias a objeto fdata
v_fatigafittedmatrix <- t(v_fatigafitted$data)
# Se extrae la matriz de datos de las funciones propias

MahaDist_ductil_a_ductilmean <- NULL
MahaDist_ductil_a_fragilmean <- NULL
MahaDist_ductil_a_fatigamean <- NULL
MahaDist_fragil_a_ductilmean <- NULL
MahaDist_fragil_a_fragilmean <- NULL
MahaDist_fragil_a_fatigamean <- NULL
MahaDist_fatiga_a_ductilmean <- NULL
MahaDist_fatiga_a_fragilmean <- NULL
MahaDist_fatiga_a_fatigamean <- NULL
# se crean los vectores que tendran las distancias de cada funcion a la media respectiva

for (i in 2801:4000) {
fittedductil_fundata <- funData(grilla,fd_fittedductil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfragil_fundata <- funData(grilla,fd_fittedfragil[,i])
# Convierte el dato funcional i esimo de ensayo en fundata
fittedfatiga_fundata <- funData(grilla,fd_fittedfatiga[,i])
# Convierte el dato funcional i esimo de ensayo en fundata

MahaDist_ductil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 3)
MahaDist_ductil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 3)
MahaDist_ductil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedductil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 3)

MahaDist_fragil_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 3)
MahaDist_fragil_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 3)
MahaDist_fragil_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfragil_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 3)

MahaDist_fatiga_a_ductilmean[i-2800] <- funDist(mean_functionductil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_ductil, phi = v_ductilfittedmatrix,k_trunc = 3)
MahaDist_fatiga_a_fragilmean[i-2800] <- funDist(mean_functionfragil_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fragil, phi = v_fragilfittedmatrix,k_trunc = 3)
MahaDist_fatiga_a_fatigamean[i-2800] <- funDist(mean_functionfatiga_fundata,fittedfatiga_fundata,metric = "L2", p = NULL, lambda = lambda_fatiga, phi = v_fatigafittedmatrix,k_trunc = 3)

}

mean(MahaDist_ductil_a_ductilmean);mean(MahaDist_ductil_a_fragilmean);mean(MahaDist_ductil_a_fatigamean)
mean(MahaDist_fragil_a_ductilmean);mean(MahaDist_fragil_a_fragilmean);mean(MahaDist_fragil_a_fatigamean)
mean(MahaDist_fatiga_a_ductilmean);mean(MahaDist_fatiga_a_fragilmean);mean(MahaDist_fatiga_a_fatigamean)
# Promedios de las distancias
```

# 21 Generación tablas de contingencia

La fracción de acierto global es de 0.5947222, para imágenes dúctiles es de 0.7608333, para imágenes frágiles de 0.6541667 y para imágenes de fatiga 0.3691667.

```{r}

C <- matrix(0,3,3)
for (i in 1:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C


sum(diag(C)) /3600 # se determina la fracción de aciertos en la clasificacion
C[1,1]/1200
C[2,2]/1200
C[3,3]/1200
```


# 21.1 Generación tablas de contingencia por fotos de ensayo

La fracción de acierto global es de 0.6666667,

Las tres dúctiles se adjudican a dúctil. Acierto 100%.
Dos de tres frágiles se adjudican correctamente. Acierto 66.6%.
Una de fatiga se adjudicó correcta. Acierto 33.3%.

```{r}

C <- matrix(0,3,3)
for (i in 1:400){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 1
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

F <- rep(0,5)
if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- 1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- 1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- 1}


C <- matrix(0,3,3)
for (i in 401:800){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 2
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

C <- matrix(0,3,3)
for (i in 801:1200){ if (MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_ductilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[1,1] <- C[1,1]+1}
  if (MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_ductilmean[i] & MahaDist_ductil_a_fragilmean[i] < MahaDist_ductil_a_fatigamean[i]){C[2,1] <- C[2,1]+1}
  if (MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_fragilmean[i] & MahaDist_ductil_a_fatigamean[i] < MahaDist_ductil_a_ductilmean[i]){C[3,1] <- C[3,1]+1}
  if (MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_ductilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[1,2] <- C[1,2]+1}
  if (MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_ductilmean[i] & MahaDist_fragil_a_fragilmean[i] < MahaDist_fragil_a_fatigamean[i]){C[2,2] <- C[2,2]+1}
  if (MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_fragilmean[i] & MahaDist_fragil_a_fatigamean[i] < MahaDist_fragil_a_ductilmean[i]){C[3,2] <- C[3,2]+1}
  if (MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_ductilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[1,3] <- C[1,3]+1}
  if (MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_ductilmean[i] & MahaDist_fatiga_a_fragilmean[i] < MahaDist_fatiga_a_fatigamean[i]){C[2,3] <- C[2,3]+1}
  if (MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_fragilmean[i] & MahaDist_fatiga_a_fatigamean[i] < MahaDist_fatiga_a_ductilmean[i]){C[3,3] <- C[3,3]+1}
}
C

# Matriz para las fotos de ensayo 3
# La primera columna es para la foto de ensayo ductil, la segunda para la de ensayo frágil y la tercera para fatiga.
# La fila corresponde a cuál está más cerca: primera fila dúctil, segunda fila frágil y tercera fila fatiga.

if (C[1,1] > C[2,1] & C[1,1] > C[3,1]){F[1] <- F[1]+1}
if (C[2,2] > C[1,2] & C[2,2] > C[3,2]){F[2] <- F[2]+1}
if (C[3,3] > C[1,3] & C[3,3] > C[2,3]){F[3] <- F[3]+1}

sum(F)/9 # Acierto global por fotos
F[1]/3 # Acierto de dúctiles
F[2]/3 # Acierto de frágiles
F[3]/3 # Acierto de fatiga

```

